<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZS's CRYPTO SHORTING COCKPIT // LOGS</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg: #f7f3ea;
            --panel: #fffdf8;
            --panel-strong: #ffffff;
            --border: #111827;
            --text: #111827;
            --muted: #6b7280;
            --primary: #111827;
            --accent: #ff8a00;
            --success: #16a34a;
            --danger: #dc2626;
            --warn: #f97316;
            --shadow: 6px 6px 0 rgba(17, 24, 39, 0.9);
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Barlow', system-ui, sans-serif;
            font-variant-numeric: tabular-nums;
            background-color: var(--bg);
            color: var(--text);
            background-image: linear-gradient(180deg, #f7f3ea 0%, #f1f5f9 55%, #f7f3ea 100%);
        }
        .font-mono {
            font-family: 'Space Mono', monospace;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(900px 500px at 10% -10%, rgba(255, 138, 0, 0.18), transparent 60%),
                radial-gradient(800px 500px at 90% 0%, rgba(17, 24, 39, 0.12), transparent 60%),
                radial-gradient(700px 450px at 50% 110%, rgba(34, 197, 94, 0.12), transparent 65%);
            pointer-events: none;
            z-index: 0;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(17, 24, 39, 0.06) 1px, transparent 1px),
                linear-gradient(90deg, rgba(17, 24, 39, 0.06) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        .brand-title {
            font-weight: 700;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            font-size: clamp(1.7rem, 2.5vw, 2.6rem);
        }
        .brand-sub {
            color: var(--muted);
            font-weight: 600;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            font-size: 0.68rem;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            border: 2px solid var(--border);
            background: #fff3db;
            color: #111827;
            font-size: 10px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--accent);
            box-shadow: 0 0 8px rgba(255, 138, 0, 0.7);
            animation: breathe 2s ease-in-out infinite;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 0.4; }
        }

        .nav-link {
            padding: 8px 14px;
            border-radius: 999px;
            border: 2px solid var(--border);
            color: var(--text);
            font-weight: 700;
            font-size: 11px;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            transition: all 0.2s ease;
            background: var(--panel);
        }
        .nav-link:hover {
            transform: translateY(-1px);
            box-shadow: 4px 4px 0 rgba(17, 24, 39, 0.8);
        }
        .nav-link.active {
            color: #111827;
            background: var(--accent);
            border-color: var(--border);
            box-shadow: 4px 4px 0 rgba(17, 24, 39, 0.9);
        }

        .cyber-panel {
            background: var(--panel);
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .panel-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.22em;
            color: var(--muted);
            font-weight: 700;
        }
        .panel-title strong {
            color: var(--text);
        }
        .panel-meta {
            font-size: 0.62rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .metric-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--muted);
        }

        .text-l1 {
            font-size: clamp(2.5rem, 3vw, 3.2rem);
            line-height: 1;
        }
        .text-l2 {
            font-size: clamp(1.4rem, 2.1vw, 1.75rem);
            line-height: 1.1;
        }
        .text-l3 {
            font-size: clamp(1.02rem, 1.6vw, 1.3rem);
            line-height: 1.2;
        }

        .section-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.7rem;
            color: var(--muted);
            letter-spacing: 0.24em;
            text-transform: uppercase;
        }
        .section-label::after {
            content: '';
            flex: 1;
            height: 2px;
            background: var(--border);
        }

        .panel-reveal {
            animation: rise-in 0.6s ease both;
        }
        @keyframes rise-in {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .table-row:nth-child(even) {
            background: rgba(17, 24, 39, 0.04);
        }
        .kpi-card {
            min-height: 110px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .kpi-card:hover {
            transform: translateY(-2px);
        }
        .kpi-primary {
            min-height: 150px;
            border: 2px solid var(--border);
        }
        .kpi-secondary {
            min-height: 120px;
        }
        .kpi-small {
            min-height: 96px;
        }
        .chart-card {
            min-height: 220px;
        }
        .kpi-card.kpi-muted {
            opacity: 0.5;
        }
        .kpi-card.kpi-active {
            border-color: var(--border);
        }

        .update-flash {
            animation: update-glow 0.6s ease;
        }
        @keyframes update-glow {
            0% { color: var(--muted); text-shadow: none; }
            50% { color: var(--accent); text-shadow: 0 0 8px rgba(255, 138, 0, 0.5); }
            100% { color: var(--muted); text-shadow: none; }
        }

        .pulse-text {
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0% { text-shadow: 0 0 6px rgba(255, 138, 0, 0.2); }
            50% { text-shadow: 0 0 16px rgba(255, 138, 0, 0.4); }
            100% { text-shadow: 0 0 6px rgba(255, 138, 0, 0.2); }
        }

        .table-head {
            background: #111827;
            color: #f8fafc;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.65rem;
        }

        .theme-brutal .text-white { color: var(--text) !important; }
        .theme-brutal .text-gray-300,
        .theme-brutal .text-gray-400,
        .theme-brutal .text-gray-500,
        .theme-brutal .text-gray-600,
        .theme-brutal .text-slate-400,
        .theme-brutal .text-slate-500 { color: var(--muted) !important; }
        .theme-brutal .text-teal-200,
        .theme-brutal .text-teal-300 { color: var(--accent) !important; }
        .theme-brutal .text-emerald-300,
        .theme-brutal .text-emerald-400,
        .theme-brutal .text-green-400,
        .theme-brutal .text-green-500 { color: var(--success) !important; }
        .theme-brutal .text-rose-300,
        .theme-brutal .text-rose-400,
        .theme-brutal .text-red-400,
        .theme-brutal .text-red-500 { color: var(--danger) !important; }
        .theme-brutal .text-amber-300,
        .theme-brutal .text-amber-400,
        .theme-brutal .text-yellow-400 { color: var(--accent) !important; }
        .theme-brutal .bg-gray-900,
        .theme-brutal .bg-gray-800,
        .theme-brutal .bg-slate-800,
        .theme-brutal .bg-slate-900 { background-color: var(--panel-strong) !important; }
        .theme-brutal .border-gray-800,
        .theme-brutal .border-gray-700,
        .theme-brutal .border-slate-700,
        .theme-brutal .border-slate-800,
        .theme-brutal .divide-gray-800 { border-color: var(--border) !important; }
        .theme-brutal .bg-black\/40 { background-color: rgba(17, 24, 39, 0.08) !important; }
        .theme-brutal .bg-black\/70 { background-color: rgba(17, 24, 39, 0.18) !important; }
        .theme-brutal .hover\:text-white:hover { color: var(--text) !important; }
        .theme-brutal .hover\:bg-white\/5:hover { background-color: rgba(17, 24, 39, 0.04) !important; }
        .theme-brutal .bg-emerald-500\/15 { background-color: rgba(22, 163, 74, 0.15) !important; }
        .theme-brutal .bg-rose-500\/15 { background-color: rgba(220, 38, 38, 0.15) !important; }
        .theme-brutal .border-emerald-500\/30 { border-color: rgba(22, 163, 74, 0.4) !important; }
        .theme-brutal .border-rose-500\/30 { border-color: rgba(220, 38, 38, 0.4) !important; }
        .theme-brutal .bg-cyan-600,
        .theme-brutal .bg-cyan-700 { background-color: var(--accent) !important; }
        .theme-brutal .border-cyan-500,
        .theme-brutal .border-cyan-400 { border-color: var(--border) !important; }

        body.mood-down::before {
            opacity: 0.25;
            filter: saturate(0.6);
        }
        body.mood-down .cyber-panel {
            border-color: rgba(17, 24, 39, 0.8);
        }

        .log-panel {
            background: var(--panel);
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
        }
        .log-line {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            line-height: 1.7;
            border-bottom: 1px dashed rgba(17, 24, 39, 0.3);
        }
        .log-line:hover {
            background: rgba(255, 138, 0, 0.08);
        }
        .log-info { color: #1f2937; }
        .log-warn { color: var(--warn); }
        .log-error { color: var(--danger); }
        .log-debug { color: #6b7280; }
        .log-time { color: #6b7280; }
        .log-level { font-weight: 700; }

    </style>
</head>
<body class="min-h-screen p-4 md:p-8 relative theme-brutal">

    <header class="topbar flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-8 relative z-10">
        <div class="flex flex-col gap-3">
            <div class="status-pill">
                <span class="status-dot"></span>
                SYSTEM LOGS
            </div>
            <div>
                <h1 class="brand-title">慢就是快</h1>
                <div class="brand-sub">CRYPTO SHORTING COCKPIT · LOGS</div>
            </div>
        </div>
        <nav class="flex items-center flex-wrap gap-3 text-sm">
            <a href="/" class="nav-link">TRADES</a>
            <a href="/live-monitor" class="nav-link">MONITOR</a>
            <a href="/metrics" class="nav-link">METRICS</a>
            <a href="/logs" class="nav-link active">LOGS</a>
        </nav>
        <div class="text-right space-y-2">
            <div class="panel-meta">Trading Philosophy</div>
            <div class="text-sm font-semibold text-teal-200 font-mono">轻仓分散做空 · 宽止损 · 固定止盈</div>
        </div>
    </header>

    <div class="section-label mb-4 relative z-10">LOG STREAM</div>

    <!-- 控制栏 -->
    <div class="log-panel rounded-xl p-4 mb-4 flex flex-wrap items-center justify-between gap-4 relative z-10 panel-reveal">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
                <i data-lucide="terminal" class="w-5 h-5 text-cyan-400"></i>
                <span class="text-white font-bold">System Logs</span>
            </div>
            <div class="text-[11px] text-gray-500">
                <span id="log-count" class="text-l3 text-white">0</span> lines
            </div>
        </div>
        <div class="flex flex-wrap items-center gap-2 md:gap-4">
            <!-- 筛选 -->
            <select id="levelFilter" class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-sm text-gray-300 focus:outline-none focus:border-cyan-500">
                <option value="all">All Levels</option>
                <option value="ERROR">ERROR</option>
                <option value="WARN">WARNING</option>
                <option value="INFO">INFO</option>
            </select>

            <!-- 搜索 -->
            <input type="text" id="searchInput" placeholder="Search..."
                class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-sm text-gray-300 w-32 md:w-40 focus:outline-none focus:border-cyan-500">

            <!-- 自动刷新 -->
            <label class="flex items-center gap-1 md:gap-2 text-xs md:text-sm text-gray-400 cursor-pointer">
                <input type="checkbox" id="autoRefresh" class="accent-cyan-500" checked>
                <span class="hidden sm:inline">Auto Refresh</span>
                <span class="sm:hidden">Auto</span>
                <span id="refreshIndicator" class="w-2 h-2 bg-green-500 rounded-full refresh-indicator"></span>
            </label>

            <!-- 手动刷新 -->
            <button onclick="fetchLogs()" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded text-sm transition-colors">
                <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i>
            </button>
        </div>
    </div>

    <!-- 日志内容 -->
    <div class="log-panel rounded-xl overflow-hidden relative z-10 panel-reveal">
        <div id="logContainer" class="p-4 max-h-[70vh] overflow-y-auto">
            <div class="text-gray-500 text-center py-8">Loading logs...</div>
        </div>
    </div>

    <script>
        lucide.createIcons({ attrs: { 'stroke-width': 1.6 } });

        let allLogs = [];
        let refreshInterval = null;

        async function fetchLogs() {
            try {
                const res = await fetch('/api/logs?lines=500');
                const data = await res.json();
                allLogs = data.logs || [];
                renderLogs();
            } catch (error) {
                console.error('Error fetching logs:', error);
                document.getElementById('logContainer').innerHTML =
                    '<div class="text-red-400 text-center py-8">Failed to load logs</div>';
            }
        }

        function renderLogs() {
            const container = document.getElementById('logContainer');
            const levelFilter = document.getElementById('levelFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            let filteredLogs = allLogs;

            // 按级别筛选
            if (levelFilter !== 'all') {
                filteredLogs = filteredLogs.filter(line => line.includes(`| ${levelFilter}`));
            }

            // 按关键词搜索
            if (searchText) {
                filteredLogs = filteredLogs.filter(line => line.toLowerCase().includes(searchText));
            }

            document.getElementById('log-count').innerText = filteredLogs.length;

            if (filteredLogs.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-8">No logs found</div>';
                return;
            }

            const html = filteredLogs.map(line => {
                let levelClass = 'log-info';
                if (line.includes('| ERROR')) levelClass = 'log-error';
                else if (line.includes('| WARN')) levelClass = 'log-warn';
                else if (line.includes('| DEBUG')) levelClass = 'log-debug';

                // 高亮时间戳
                const formatted = line
                    .replace(/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/, '<span class="log-time">$1</span>')
                    .replace(/\| (INFO|WARN|ERROR|DEBUG)/, '| <span class="log-level">$1</span>');

                return `<div class="log-line ${levelClass} px-2 py-1">${formatted}</div>`;
            }).join('');

            container.innerHTML = html;
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');
            const indicator = document.getElementById('refreshIndicator');

            if (checkbox.checked) {
                refreshInterval = setInterval(fetchLogs, 5000);
                indicator.classList.add('refresh-indicator');
                indicator.classList.remove('bg-gray-500');
                indicator.classList.add('bg-green-500');
            } else {
                if (refreshInterval) clearInterval(refreshInterval);
                indicator.classList.remove('refresh-indicator');
                indicator.classList.remove('bg-green-500');
                indicator.classList.add('bg-gray-500');
            }
        }

        // 事件绑定
        document.getElementById('levelFilter').addEventListener('change', renderLogs);
        document.getElementById('searchInput').addEventListener('input', renderLogs);
        document.getElementById('autoRefresh').addEventListener('change', toggleAutoRefresh);

        // 初始化
        fetchLogs();
        toggleAutoRefresh();
    </script>
</body>
</html>
